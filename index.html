<!DOCTYPE html>
<html lang="es">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Acceso Premium | Sistema Exclusivo</title>
ย ย <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
ย ย <style>
ย ย ย ย * {
ย ย ย ย ย ย margin: 0;
ย ย ย ย ย ย padding: 0;
ย ย ย ย ย ย box-sizing: border-box;
ย ย ย ย ย ย font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย body {
ย ย ย ย ย ย background-color: #f0f2f5;
ย ย ย ย ย ย color: #333;
ย ย ย ย ย ย line-height: 1.6;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Contenedor principal de cliente */
ย ย ย ย #client-container {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย height: 100vh;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .container {
ย ย ย ย ย ย background-color: white;
ย ย ย ย ย ย padding: 2rem;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย width: 90%;
ย ย ย ย ย ย max-width: 400px;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย input, select, textarea {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย margin: 8px 0;
ย ย ย ย ย ย border: 1px solid #ddd;
ย ย ย ย ย ย border-radius: 5px;
ย ย ย ย ย ย font-size: 14px;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย input[type="text"] {
ย ย ย ย ย ย text-transform: uppercase;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย button {
ย ย ย ย ย ย background-color: #4CAF50;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย border-radius: 5px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย font-size: 14px;
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .error { color: #e74c3c; }
ย ย ย ย .success { color: #27ae60; }
ย ย ย ย .warning { color: #f39c12; }
ย ย ย ย .info { color: #3498db; }
ย ย ย ยย
ย ย ย ย /* Panel de administraciรณn */
ย ย ย ย .admin-panel {
ย ย ย ย ย ย display: none;
ย ย ย ย ย ย position: fixed;
ย ย ย ย ย ย top: 0;
ย ย ย ย ย ย left: 0;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: 100%;
ย ย ย ย ย ย background: #f5f7fa;
ย ย ย ย ย ย z-index: 1000;
ย ย ย ย ย ย overflow-y: auto;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .admin-header {
ย ย ย ย ย ย background: #2c3e50;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย padding: 1rem 2rem;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย box-shadow: 0 2px 5px rgba(0,0,0,0.1);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .admin-nav {
ย ย ย ย ย ย background: #34495e;
ย ย ย ย ย ย padding: 0.5rem 2rem;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย gap: 1rem;
ย ย ย ย ย ย flex-wrap: wrap;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .nav-btn {
ย ย ย ย ย ย background: transparent;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย color: #ecf0f1;
ย ย ย ย ย ย padding: 0.5rem 1rem;
ย ย ย ย ย ย border-radius: 4px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย transition: background 0.3s;
ย ย ย ย ย ย width: auto;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .nav-btn:hover, .nav-btn.active {
ย ย ย ย ย ย background: #3498db;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .admin-content {
ย ย ย ย ย ย padding: 2rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .dashboard-cards {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
ย ย ย ย ย ย gap: 1.5rem;
ย ย ย ย ย ย margin-bottom: 2rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .card {
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย padding: 1.5rem;
ย ย ย ย ย ย box-shadow: 0 2px 10px rgba(0,0,0,0.05);
ย ย ย ย ย ย text-align: center;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .card-icon {
ย ย ย ย ย ย font-size: 2.5rem;
ย ย ย ย ย ย margin-bottom: 1rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .card-title {
ย ย ย ย ย ย font-size: 1.2rem;
ย ย ย ย ย ย margin-bottom: 0.5rem;
ย ย ย ย ย ย color: #2c3e50;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .card-value {
ย ย ย ย ย ย font-size: 2rem;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย color: #3498db;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .card.active { border-top: 4px solid #2ecc71; }
ย ย ย ย .card.inactive { border-top: 4px solid #e74c3c; }
ย ย ย ย .card.devices { border-top: 4px solid #3498db; }
ย ย ย ย .card.usage { border-top: 4px solid #f39c12; }
ย ย ย ยย
ย ย ย ย .admin-section {
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย padding: 1.5rem;
ย ย ย ย ย ย box-shadow: 0 2px 10px rgba(0,0,0,0.05);
ย ย ย ย ย ย margin-bottom: 2rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .section-title {
ย ย ย ย ย ย font-size: 1.3rem;
ย ย ย ย ย ย margin-bottom: 1.5rem;
ย ย ย ย ย ย color: #2c3e50;
ย ย ย ย ย ย padding-bottom: 0.5rem;
ย ย ย ย ย ย border-bottom: 1px solid #eee;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .section-actions {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย gap: 0.5rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-grid {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
ย ย ย ย ย ย gap: 1rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-item {
ย ย ย ย ย ย background: #f8f9fa;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย padding: 1rem;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย border-left: 4px solid #2ecc71;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย align-items: flex-start;
ย ย ย ย ย ย gap: 0.5rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-item.inactive {
ย ย ย ย ย ย border-left-color: #e74c3c;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-info {
ย ย ย ย ย ย flex: 1;
ย ย ย ย ย ย width: 100%;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-header {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย margin-bottom: 0.5rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-value {
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย font-size: 1.2rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-name {
ย ย ย ย ย ย font-weight: 500;
ย ย ย ย ย ย color: #2c3e50;
ย ย ย ย ย ย margin-bottom: 0.3rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-contact {
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย color: #7f8c8d;
ย ย ย ย ย ย margin-bottom: 0.5rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-stats {
ย ย ย ย ย ย font-size: 0.85rem;
ย ย ย ย ย ย color: #7f8c8d;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย gap: 0.5rem;
ย ย ย ย ย ย flex-wrap: wrap;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .code-actions {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย gap: 0.5rem;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย justify-content: flex-end;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .action-btn {
ย ย ย ย ย ย padding: 0.4rem 0.6rem;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย border-radius: 4px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 0.3rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .btn-activate {
ย ย ย ย ย ย background: #2ecc71;
ย ย ย ย ย ย color: white;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .btn-deactivate {
ย ย ย ย ย ย background: #e74c3c;
ย ย ย ย ย ย color: white;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .btn-edit {
ย ย ย ย ย ย background: #3498db;
ย ย ย ย ย ย color: white;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .btn-info {
ย ย ย ย ย ย background: #f39c12;
ย ย ย ย ย ย color: white;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .device-list {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย gap: 1rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .device-item {
ย ย ย ย ย ย background: #f8f9fa;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย padding: 1rem;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .device-info {
ย ย ย ย ย ย flex: 1;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .device-id {
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย margin-bottom: 0.3rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .device-meta {
ย ย ย ย ย ย font-size: 0.85rem;
ย ย ย ย ย ย color: #7f8c8d;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .admin-login {
ย ย ย ย ย ย display: none;
ย ย ย ย ย ย max-width: 400px;
ย ย ย ย ย ย margin: 100px auto;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .admin-link {
ย ย ย ย ย ย position: fixed;
ย ย ย ย ย ย bottom: 10px;
ย ย ย ย ย ย right: 10px;
ย ย ย ย ย ย background: #2c3e50;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย width: 40px;
ย ย ย ย ย ย height: 40px;
ย ย ย ย ย ย border-radius: 50%;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย text-decoration: none;
ย ย ย ย ย ย font-size: 20px;
ย ย ย ย ย ย box-shadow: 0 2px 5px rgba(0,0,0,0.2);
ย ย ย ย ย ย z-index: 100;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .tab-content {
ย ย ย ย ย ย display: none;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .tab-content.active {
ย ย ย ย ย ย display: block;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .form-group {
ย ย ย ย ย ย margin-bottom: 1rem;
ย ย ย ย ย ย text-align: left;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .form-group label {
ย ย ย ย ย ย display: block;
ย ย ย ย ย ย margin-bottom: 0.5rem;
ย ย ย ย ย ย font-weight: 500;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .filters {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
ย ย ย ย ย ย gap: 1rem;
ย ย ย ย ย ย margin-bottom: 1.5rem;
ย ย ย ย ย ย background: #f8f9fa;
ย ย ย ย ย ย padding: 1rem;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .search-box {
ย ย ย ย ย ย margin-bottom: 1.5rem;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย gap: 0.5rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .search-box input {
ย ย ย ย ย ย flex: 1;
ย ย ย ย ย ย margin: 0;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .search-box button {
ย ย ย ย ย ย width: auto;
ย ย ย ย ย ย margin: 0;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .status-badge {
ย ย ย ย ย ย display: inline-block;
ย ย ย ย ย ย padding: 0.2rem 0.5rem;
ย ย ย ย ย ย border-radius: 20px;
ย ย ย ย ย ย font-size: 0.8rem;
ย ย ย ย ย ย font-weight: 500;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .status-active {
ย ย ย ย ย ย background: #e8f5e9;
ย ย ย ย ย ย color: #2ecc71;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .status-inactive {
ย ย ย ย ย ย background: #ffebee;
ย ย ย ย ย ย color: #e74c3c;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .modal {
ย ย ย ย ย ย display: none;
ย ย ย ย ย ย position: fixed;
ย ย ย ย ย ย top: 0;
ย ย ย ย ย ย left: 0;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: 100%;
ย ย ย ย ย ย background: rgba(0,0,0,0.5);
ย ย ย ย ย ย z-index: 2000;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .modal-content {
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย padding: 2rem;
ย ย ย ย ย ย width: 90%;
ย ย ย ย ย ย max-width: 500px;
ย ย ย ย ย ย max-height: 90vh;
ย ย ย ย ย ย overflow-y: auto;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .modal-header {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย margin-bottom: 1.5rem;
ย ย ย ย ย ย padding-bottom: 0.5rem;
ย ย ย ย ย ย border-bottom: 1px solid #eee;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .close-modal {
ย ย ย ย ย ย background: none;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย font-size: 1.5rem;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย color: #7f8c8d;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .detail-row {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย margin-bottom: 0.5rem;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .detail-label {
ย ย ย ย ย ย font-weight: 500;
ย ย ย ย ย ย width: 120px;
ย ย ย ย ย ย color: #7f8c8d;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .detail-value {
ย ย ย ย ย ย flex: 1;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .detail-section {
ย ย ย ย ย ย margin-bottom: 1.5rem;
ย ย ย ย ย ย padding-bottom: 1rem;
ย ย ย ย ย ย border-bottom: 1px solid #eee;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .detail-section:last-child {
ย ย ย ย ย ย border-bottom: none;
ย ย ย ย ย ย margin-bottom: 0;
ย ย ย ย ย ย padding-bottom: 0;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย @media (max-width: 768px) {
ย ย ย ย ย ย .dashboard-cards {
ย ย ย ย ย ย ย ย grid-template-columns: 1fr;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย .code-grid {
ย ย ย ย ย ย ย ย grid-template-columns: 1fr;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย .filters {
ย ย ย ย ย ย ย ย grid-template-columns: 1fr;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย .admin-nav {
ย ย ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย ย ย gap: 0.5rem;
ย ย ย ย ย ย }
ย ย ย ย }
ย ย </style>
</head>
<body>
ย ย ย ย <div id="client-container" style="display: flex;">
ย ย ย ย <div class="container">
ย ย ย ย ย ย <h1>๐ Acceso al Sistema</h1>
ย ย ย ย ย ย <form id="access-form">
ย ย ย ย ย ย ย ย <input type="text" id="code" placeholder="Ej: A1B2" required maxlength="4" pattern="[A-Z0-9]{4}" title="4 letras/nรบmeros (mayรบsculas)">
ย ย ย ย ย ย ย ย <button type="submit">INGRESAR</button>
ย ย ย ย ย ย </form>
ย ย ย ย ย ย <p id="message" class="error"></p>
ย ย ย ย ย ย <p id="device-info" class="info"></p>
ย ย ย ย ย ย <p class="warning"><small>Horario de soporte: <strong>10:00 AM - 4:00 PM</strong></small></p>
ย ย ย ย ย ย <p><small>ยฟProblemas? Contacta a soporte: <strong>0412-527-8450</strong></small></p>
ย ย ย ย </div>
ย ย ย ยย
ย ย ย ย ย ย ย ย <a href="#" class="admin-link" id="admin-access">
ย ย ย ย ย ย <i class="fas fa-cog"></i>
ย ย ย ย </a>
ย ย </div>

ย ย ย ย <div class="admin-login" id="admin-login">
ย ย ย ย <h2><i class="fas fa-lock"></i> Acceso Administrador</h2>
ย ย ย ย <form id="admin-login-form">
ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย <label for="admin-user-login">Usuario:</label>
ย ย ย ย ย ย ย ย <input type="text" id="admin-user-login" placeholder="Usuario" required>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย <label for="admin-password-login">Contraseรฑa:</label>
ย ย ย ย ย ย ย ย <input type="password" id="admin-password-login" placeholder="Contraseรฑa" required>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <button type="submit"><i class="fas fa-sign-in-alt"></i> ACCEDER</button>
ย ย ย ย </form>
ย ย ย ย <p id="admin-message" class="error"></p>
ย ย </div>

ย ย ย ย <div class="admin-panel" id="admin-panel">
ย ย ย ย <div class="admin-header">
ย ย ย ย ย ย <h2><i class="fas fa-shield-alt"></i> Panel de Administraciรณn</h2>
ย ย ย ย ย ย <button id="logout-btn" class="nav-btn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesiรณn</button>
ย ย ย ย </div>
ย ย ย ยย
ย ย ย ย <div class="admin-nav">
ย ย ย ย ย ย <button class="nav-btn active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
ย ย ย ย ย ย <button class="nav-btn" data-tab="codes"><i class="fas fa-key"></i> Cรณdigos</button>
ย ย ย ย ย ย <button class="nav-btn" data-tab="devices"><i class="fas fa-laptop"></i> Dispositivos</button>
ย ย ย ย ย ย <button class="nav-btn" data-tab="settings"><i class="fas fa-cog"></i> Configuraciรณn</button>
ย ย ย ย </div>
ย ย ย ยย
ย ย ย ย <div class="admin-content">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="tab-content active" id="dashboard">
ย ย ย ย ย ย ย ย <h2 class="section-title">Resumen del Sistema</h2>
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <div class="dashboard-cards">
ย ย ย ย ย ย ย ย ย ย <div class="card active">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-icon"><i class="fas fa-check-circle"></i></div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-title">Cรณdigos Activos</div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-value" id="stat-active">0</div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="card inactive">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-icon"><i class="fas fa-times-circle"></i></div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-title">Cรณdigos Inactivos</div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-value" id="stat-inactive">0</div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="card devices">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-icon"><i class="fas fa-laptop"></i></div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-title">Dispositivos Registrados</div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-value" id="stat-devices">0</div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="card usage">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-icon"><i class="fas fa-chart-line"></i></div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-title">Uso Promedio</div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="card-value" id="stat-usage">0%</div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <div class="admin-section">
ย ย ย ย ย ย ย ย ย ย <h3 class="section-title">Cรณdigos Recientes</h3>
ย ย ย ย ย ย ย ย ย ย <div class="code-grid" id="recent-codes"></div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="tab-content" id="codes">
ย ย ย ย ย ย ย ย <h2 class="section-title">Gestiรณn de Cรณdigos de Acceso</h2>
ย ย ย ย ย ย ย ย <div class="admin-section">
ย ย ย ย ย ย ย ย ย ย <div class="filters">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label>Estado:</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select id="filter-status">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="">Todos</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="active">Activos</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="inactive">Inactivos</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label>Dispositivos:</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select id="filter-devices">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="">Todos</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="full">Llenos</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="available">Con espacio</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label>Ordenar por:</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select id="filter-sort">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="recent">Mรกs recientes</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="oldest">Mรกs antiguos</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="name">Nombre</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="code">Cรณdigo</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="search-box">
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="code-search" placeholder="Buscar por cรณdigo, nombre, telรฉfono...">
ย ย ย ย ย ย ย ย ย ย ย ย <button id="search-btn"><i class="fas fa-search"></i></button>
ย ย ย ย ย ย ย ย ย ย ย ย <button id="clear-search" class="action-btn btn-deactivate"><i class="fas fa-times"></i> Limpiar</button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="section-actions">
ย ย ย ย ย ย ย ย ย ย ย ย <button id="generate-code-btn" class="action-btn btn-activate">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-plus"></i> Generar Nuevo Cรณdigo
ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="code-grid" id="all-codes"></div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="tab-content" id="devices">
ย ย ย ย ย ย ย ย <h2 class="section-title">Dispositivos Registrados</h2>
ย ย ย ย ย ย ย ย <div class="admin-section">
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label>Filtrar por cรณdigo:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <select id="code-selector">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="">Todos los dispositivos</option>
ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="device-list" id="devices-list"></div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="tab-content" id="settings">
ย ย ย ย ย ย ย ย <h2 class="section-title">Configuraciรณn del Sistema</h2>
ย ย ย ย ย ย ย ย <div class="admin-section">
ย ย ย ย ย ย ย ย ย ย <h3 class="section-title">Lรญmites del Sistema</h3>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label>Lรญmite de dispositivos por cรณdigo:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" id="max-devices" value="3" min="1" max="10">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label>Tiempo de inactividad (minutos):</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" id="inactivity-timeout" value="10" min="1" max="60">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label>URL de redirecciรณn:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="redirect-url" placeholder="https://ejemplo.com">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <button id="save-settings" class="action-btn btn-activate"><i class="fas fa-save"></i> Guardar Configuraciรณn</button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="admin-section">
ย ย ย ย ย ย ย ย ย ย <h3 class="section-title">Credenciales de Administrador</h3>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label>Usuario:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" id="admin-username-settings" placeholder="Usuario administrador">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label>Nueva Contraseรฑa:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="password" id="admin-password-settings" placeholder="Dejar en blanco para no cambiar">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label>Confirmar contraseรฑa:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="password" id="admin-password-confirm" placeholder="Confirmar nueva contraseรฑa">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <button id="save-admin" class="action-btn btn-activate"><i class="fas fa-save"></i> Guardar Credenciales</button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="admin-section">
ย ย ย ย ย ย ย ย ย ย <h3 class="section-title">Exportar/Importar Datos</h3>
ย ย ย ย ย ย ย ย ย ย <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
ย ย ย ย ย ย ย ย ย ย ย ย <button id="export-data" class="action-btn btn-edit"><i class="fas fa-download"></i> Exportar Datos</button>
ย ย ย ย ย ย ย ย ย ย ย ย <button id="import-data" class="action-btn btn-edit"><i class="fas fa-upload"></i> Importar Datos</button>
ย ย ย ย ย ย ย ย ย ย ย ย <button id="reset-data" class="action-btn btn-deactivate"><i class="fas fa-trash"></i> Restablecer Datos</button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย ย ย <div class="modal" id="code-detail-modal">
ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย <div class="modal-header">
ย ย ย ย ย ย ย ย <h3>Detalles del Cรณdigo</h3>
ย ย ย ย ย ย ย ย <button class="close-modal">&times;</button>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div id="code-detail-content"></div>
ย ย ย ย </div>
ย ย </div>

ย ย ย ย <div class="modal" id="code-edit-modal">
ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย <div class="modal-header">
ย ย ย ย ย ย ย ย <h3 id="code-edit-title">Nuevo Cรณdigo</h3>
ย ย ย ย ย ย ย ย <button class="close-modal">&times;</button>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย <label for="edit-code">Cรณdigo:</label>
ย ย ย ย ย ย ย ย <input type="text" id="edit-code" maxlength="4" pattern="[A-Z0-9]{4}" required>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย <label for="edit-name">Nombre del cliente:</label>
ย ย ย ย ย ย ย ย <input type="text" id="edit-name">
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย <label for="edit-phone">Telรฉfono:</label>
ย ย ย ย ย ย ย ย <input type="text" id="edit-phone">
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย <label for="edit-email">Email:</label>
ย ย ย ย ย ย ย ย <input type="email" id="edit-email">
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย <label for="edit-notes">Notas:</label>
ย ย ย ย ย ย ย ย <textarea id="edit-notes" rows="3"></textarea>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย <label for="edit-status">Estado:</label>
ย ย ย ย ย ย ย ย <select id="edit-status">
ย ย ย ย ย ย ย ย ย ย <option value="active">Activo</option>
ย ย ย ย ย ย ย ย ย ย <option value="inactive">Inactivo</option>
ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <button id="save-code-btn" class="action-btn btn-activate">Guardar Cรณdigo</button>
ย ย ย ย </div>
ย ย </div>

ย ย ย ย <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
ย ย <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

ย ย <script>
ย ย ย ย // TODO: Reemplaza esto con la configuraciรณn de tu proyecto Firebase
ย ย ย ย // Puedes encontrar esta configuraciรณn en la consola de Firebase > Configuraciรณn del proyecto > Tus apps > App web
ย ย ย ย const firebaseConfig = {
ย ย ย ย ย ย apiKey: "TU_API_KEY_AQUI", // ยกImportante! Pega tu clave API web aquรญ
ย ย ย ย ย ย authDomain: "sistema-acceso-d6bfd.firebaseapp.com",
ย ย ย ย ย ย databaseURL: "https://sistema-acceso-d6bfd-default-rtdb.firebaseio.com",
ย ย ย ย ย ย projectId: "sistema-acceso-d6bfd",
ย ย ย ย ย ย storageBucket: "sistema-acceso-d6bfd.appspot.com",
ย ย ย ย ย ย messagingSenderId: "802239933617",
ย ย ย ย ย ย appId: "TU_APP_ID_AQUI" // ยกImportante! Pega tu ID de aplicaciรณn aquรญ
ย ย ย ย };

ย ย ย ย // Inicializar Firebase
ย ย ย ย firebase.initializeApp(firebaseConfig);
ย ย ย ย const database = firebase.database();

ย ย ย ย // ๐ Configuraciรณn de Seguridad (ahora cargada desde Firebase)
ย ย ย ย const SECURITY_CONFIG = {
ย ย ย ย ย ย MAX_DEVICES: 3,
ย ย ย ย ย ย INACTIVITY_TIMEOUT: 10 * 60 * 1000,
ย ย ย ย ย ย CODE_VALIDATION_DELAY: 800,
ย ย ย ย ย ย SALT: "xQ9#pL2$kM5&vR1",
ย ย ย ย ย ย REDIRECT_URL: "https://luishparedes.github.io/massiel/",
ย ย ย ย ย ย ADMIN_USER: "admin",
ย ย ย ย ย ย ADMIN_PASSWORD: "admin123"
ย ย ย ย };
ย ย ย ยย
ย ย ย ย // ๐ก๏ธ Sistema de Seguridad Mejorado con Firebase
ย ย ย ย class CodeSecuritySystem {
ย ย ย ย ย ย constructor() {
ย ย ย ย ย ย ย ย this.initSessionProtection();
ย ย ย ย ย ย ย ย this.checkExistingSession();
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async loadConfig() {
ย ย ย ย ย ย ย ย const snapshot = await database.ref('config').once('value');
ย ย ย ย ย ย ย ย const dbConfig = snapshot.val();
ย ย ย ย ย ย ย ย if (dbConfig) {
ย ย ย ย ย ย ย ย ย ย SECURITY_CONFIG.MAX_DEVICES = dbConfig.maxDevices || SECURITY_CONFIG.MAX_DEVICES;
ย ย ย ย ย ย ย ย ย ย SECURITY_CONFIG.INACTIVITY_TIMEOUT = (dbConfig.inactivityTimeout || 10) * 60 * 1000;
ย ย ย ย ย ย ย ย ย ย SECURITY_CONFIG.REDIRECT_URL = dbConfig.redirectUrl || SECURITY_CONFIG.REDIRECT_URL;
ย ย ย ย ย ย ย ย ย ย SECURITY_CONFIG.ADMIN_USER = dbConfig.adminUser || SECURITY_CONFIG.ADMIN_USER;
ย ย ย ย ย ย ย ย ย ย SECURITY_CONFIG.ADMIN_PASSWORD = dbConfig.adminPassword || SECURITY_CONFIG.ADMIN_PASSWORD;
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย // Si no hay config en DB, la creamos con los valores por defecto
ย ย ย ย ย ย ย ย ย ย await this.updateSettings({
ย ย ย ย ย ย ย ย ย ย ย ย maxDevices: SECURITY_CONFIG.MAX_DEVICES,
ย ย ย ย ย ย ย ย ย ย ย ย inactivityTimeout: SECURITY_CONFIG.INACTIVITY_TIMEOUT / (60 * 1000),
ย ย ย ย ย ย ย ย ย ย ย ย redirectUrl: SECURITY_CONFIG.REDIRECT_URL,
ย ย ย ย ย ย ย ย ย ย ย ย adminUser: SECURITY_CONFIG.ADMIN_USER,
ย ย ย ย ย ย ย ย ย ย ย ย adminPassword: SECURITY_CONFIG.ADMIN_PASSWORD
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย generateDeviceId() {
ย ย ย ย ย ย ย ย let storedId = localStorage.getItem('secureDeviceId');
ย ย ย ย ย ย ย ย if (storedId) return storedId;
ย ย ย ย ย ย ย ย const fingerprint = [navigator.userAgent, navigator.hardwareConcurrency, screen.width, screen.height, navigator.deviceMemory, SECURITY_CONFIG.SALT].join('|');
ย ย ย ย ย ย ย ย const deviceId = this.hashString(fingerprint) + '-' + Date.now().toString(36);
ย ย ย ย ย ย ย ย localStorage.setItem('secureDeviceId', deviceId);
ย ย ย ย ย ย ย ย return deviceId;
ย ย ย ย ย ย }

ย ย ย ย ย ย hashString(str) {
ย ย ย ย ย ย ย ย let hash = 5381;
ย ย ย ย ย ย ย ย for (let i = 0; i < str.length; i++) {
ย ย ย ย ย ย ย ย ย ย hash = (hash * 33) ^ str.charCodeAt(i);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย return (hash >>> 0).toString(36);
ย ย ย ย ย ย }

ย ย ย ย ย ย async getRegisteredDevices(code) {
ย ย ย ย ย ย ย ย const snapshot = await database.ref(`codes/${code}/devices`).once('value');
ย ย ย ย ย ย ย ย const devices = snapshot.val() || {};
ย ย ย ย ย ย ย ย return Object.values(devices);
ย ย ย ย ย ย }

ย ย ย ย ย ย async registerDevice(code) {
ย ย ย ย ย ย ย ย const deviceId = this.generateDeviceId();
ย ย ย ย ย ย ย ย const devices = await this.getRegisteredDevices(code);

ย ย ย ย ย ย ย ย if (devices.some(dev => dev.id === deviceId)) {
ย ย ย ย ย ย ย ย ย ย // Actualizar lastAccess
ย ย ย ย ย ย ย ย ย ย await database.ref(`codes/${code}/devices/${deviceId}/lastAccess`).set(Date.now());
ย ย ย ย ย ย ย ย ย ย return { success: true, isNew: false };
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย if (devices.length >= SECURITY_CONFIG.MAX_DEVICES) {
ย ย ย ย ย ย ย ย ย ย return { success: false, reason: "Lรญmite de dispositivos alcanzado" };
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย const newDevice = {
ย ย ย ย ย ย ย ย ย ย id: deviceId,
ย ย ย ย ย ย ย ย ย ย timestamp: Date.now(),
ย ย ย ย ย ย ย ย ย ย ua: navigator.userAgent.substring(0, 120),
ย ย ย ย ย ย ย ย ย ย lastAccess: Date.now()
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย await database.ref(`codes/${code}/devices/${deviceId}`).set(newDevice);
ย ย ย ย ย ย ย ย return { success: true, isNew: true };
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย initSessionProtection() {
ย ย ย ย ย ย ย ย const events = ['mousemove', 'keydown', 'click', 'scroll', 'touchstart'];
ย ย ย ย ย ย ย ย events.forEach(evt => document.addEventListener(evt, this.resetInactivityTimer.bind(this)));
ย ย ย ย ย ย ย ย this.resetInactivityTimer();
ย ย ย ย ย ย }

ย ย ย ย ย ย resetInactivityTimer() {
ย ย ย ย ย ย ย ย clearTimeout(this.inactivityTimer);
ย ย ย ย ย ย ย ย this.inactivityTimer = setTimeout(() => this.handleInactiveSession(), SECURITY_CONFIG.INACTIVITY_TIMEOUT);
ย ย ย ย ย ย }

ย ย ย ย ย ย handleInactiveSession() {
ย ย ย ย ย ย ย ย sessionStorage.removeItem('activeSessionToken');
ย ย ย ย ย ย ย ย if (localStorage.getItem('currentValidCode')) {
ย ย ย ย ย ย ย ย ย ย window.location.href = window.location.pathname;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย async checkExistingSession() {
ย ย ย ย ย ย ย ย const savedCode = localStorage.getItem('currentValidCode');
ย ย ย ย ย ย ย ย const sessionToken = sessionStorage.getItem('activeSessionToken');
ย ย ย ย ย ย ย ย if (savedCode && sessionToken) {
ย ย ย ย ย ย ย ย ย ย await this.loadConfig();
ย ย ย ย ย ย ย ย ย ย const devices = await this.getRegisteredDevices(savedCode);
ย ย ย ย ย ย ย ย ย ย const deviceId = this.generateDeviceId();
ย ย ย ย ย ย ย ย ย ย if (devices.some(dev => dev.id === deviceId)) {
ย ย ย ย ย ย ย ย ย ย ย ย setTimeout(() => { window.location.href = SECURITY_CONFIG.REDIRECT_URL; }, 500);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย async validateAccessCode(code) {
ย ย ย ย ย ย ย ย return new Promise(async (resolve) => {
ย ย ย ย ย ย ย ย ย ย setTimeout(async () => {
ย ย ย ย ย ย ย ย ย ย ย ย await this.loadConfig();
ย ย ย ย ย ย ย ย ย ย ย ย const snapshot = await database.ref(`codes/${code}`).once('value');
ย ย ย ย ย ย ย ย ย ย ย ย const codeData = snapshot.val();

ย ย ย ย ย ย ย ย ย ย ย ย if (!codeData || !codeData.active) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย resolve({ valid: false, error: "Cรณdigo no vรกlido o inactivo" });
ย ย ย ย ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย ย ย const registration = await this.registerDevice(code);
ย ย ย ย ย ย ย ย ย ย ย ย if (!registration.success) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย resolve({ valid: false, error: registration.reason });
ย ย ย ย ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย ย ย localStorage.setItem('currentValidCode', code);
ย ย ย ย ย ย ย ย ย ย ย ย sessionStorage.setItem('activeSessionToken', this.hashString(Date.now().toString()));
ย ย ย ย ย ย ย ย ย ย ย ย resolve({ valid: true, isNewDevice: registration.isNew });
ย ย ย ย ย ย ย ย ย ย }, SECURITY_CONFIG.CODE_VALIDATION_DELAY);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async getDeviceRegistrationInfo(code) {
ย ย ย ย ย ย ย ย await this.loadConfig();
ย ย ย ย ย ย ย ย const devices = await this.getRegisteredDevices(code);
ย ย ย ย ย ย ย ย const currentDeviceId = this.generateDeviceId();
ย ย ย ย ย ย ย ย const isCurrentRegistered = devices.some(dev => dev.id === currentDeviceId);
ย ย ย ย ย ย ย ย const availableSlots = SECURITY_CONFIG.MAX_DEVICES - devices.length;
ย ย ย ย ย ย ย ย return {
ย ย ย ย ย ย ย ย ย ย isRegistered: isCurrentRegistered,
ย ย ย ย ย ย ย ย ย ย registeredDevices: devices.length,
ย ย ย ย ย ย ย ย ย ย maxDevices: SECURITY_CONFIG.MAX_DEVICES,
ย ย ย ย ย ย ย ย ย ย availableSlots: availableSlots > 0 ? availableSlots : 0
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย }

ย ย ย ย ย ย // Mรฉtodos para el panel de administraciรณn
ย ย ย ย ย ย async getAllCodes() {
ย ย ย ย ย ย ย ย const snapshot = await database.ref('codes').once('value');
ย ย ย ย ย ย ย ย const allCodesData = snapshot.val() || {};
ย ย ย ย ย ย ย ย return Object.entries(allCodesData).map(([code, data]) => {
ย ย ย ย ย ย ย ย ย ย const devices = data.devices ? Object.values(data.devices) : [];
ย ย ย ย ย ย ย ย ย ย return {
ย ย ย ย ย ย ย ย ย ย ย ย code: code,
ย ย ย ย ย ย ย ย ย ย ย ย active: data.active || false,
ย ย ย ย ย ย ย ย ย ย ย ย devices: devices.length,
ย ย ย ย ย ย ย ย ย ย ย ย created: new Date(data.created || 0),
ย ย ย ย ย ย ย ย ย ย ย ย lastAccess: devices.length > 0 ? new Date(Math.max(...devices.map(d => d.lastAccess || d.timestamp))) : null,
ย ย ย ย ย ย ย ย ย ย ย ย ...(data.clientInfo || { name: '', phone: '', email: '', notes: '' })
ย ย ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async saveClientInfo(code, info) {
ย ย ย ย ย ย ย ย await database.ref(`codes/${code}/clientInfo`).set(info);
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async setCodeStatus(code, active) {
ย ย ย ย ย ย ย ย await database.ref(`codes/${code}/active`).set(active);
ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async removeDevice(code, deviceId) {
ย ย ย ย ย ย ย ย await database.ref(`codes/${code}/devices/${deviceId}`).remove();
ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async generateNewCode() {
ย ย ย ย ย ย ย ย const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
ย ย ย ย ย ย ย ย let newCode = '';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย while (true) {
ย ย ย ย ย ย ย ย ย ย newCode = '';
ย ย ย ย ย ย ย ย ย ย for (let i = 0; i < 4; i++) {
ย ย ย ย ย ย ย ย ย ย ย ย newCode += characters.charAt(Math.floor(Math.random() * characters.length));
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย const snapshot = await database.ref(`codes/${newCode}`).once('value');
ย ย ย ย ย ย ย ย ย ย if (!snapshot.exists()) break;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย await database.ref(`codes/${newCode}`).set({
ย ย ย ย ย ย ย ย ย ย active: true,
ย ย ย ย ย ย ย ย ย ย created: new Date().toISOString(),
ย ย ย ย ย ย ย ย ย ย clientInfo: { name: '', phone: '', email: '', notes: '' }
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย return newCode;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async getDevicesByCode(code) {
ย ย ย ย ย ย ย ย if (!code) {
ย ย ย ย ย ย ย ย ย ย const allCodes = await this.getAllCodes();
ย ย ย ย ย ย ย ย ย ย let allDevices = [];
ย ย ย ย ย ย ย ย ย ย for(const codeData of allCodes) {
ย ย ย ย ย ย ย ย ย ย ย ย const devices = await this.getRegisteredDevices(codeData.code);
ย ย ย ย ย ย ย ย ย ย ย ย allDevices.push(...devices.map(d => ({...d, code: codeData.code, clientName: codeData.name})));
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย return allDevices;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย const devices = await this.getRegisteredDevices(code);
ย ย ย ย ย ย ย ย const clientSnapshot = await database.ref(`codes/${code}/clientInfo`).once('value');
ย ย ย ย ย ย ย ย const clientName = clientSnapshot.val()?.name || '';
ย ย ย ย ย ย ย ย return devices.map(d => ({...d, code: code, clientName: clientName}));
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async updateSettings(newSettings) {
ย ย ย ย ย ย ย ย await database.ref('config').update(newSettings);
ย ย ย ย ย ย ย ย await this.loadConfig(); // Recargar la configuraciรณn local
ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async exportData() {
ย ย ย ย ย ย ย ย const snapshot = await database.ref().once('value');
ย ย ย ย ย ย ย ย return JSON.stringify(snapshot.val(), null, 2);
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async importData(jsonData) {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const data = JSON.parse(jsonData);
ย ย ย ย ย ย ย ย ย ย await database.ref().set(data);
ย ย ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย ย ย } catch (e) {
ย ย ย ย ย ย ย ย ย ย console.error("Error importing data:", e);
ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async resetData() {
ย ย ย ย ย ย ย ย if (confirm('ยฟESTร SEGURO? Esta acciรณn reemplazarรก TODOS los datos en Firebase con la lista de cรณdigos original. No se puede deshacer.')) {
ย ย ย ย ย ย ย ย ย ย await database.ref('codes').remove();
ย ย ย ย ย ย ย ย ย ย await seedInitialData();
ย ย ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // ๐จโ๐ผ Sistema de Administraciรณn
ย ย ย ย class AdminSystem {
ย ย ย ย ย ย constructor(securitySystem) {
ย ย ย ย ย ย ย ย this.securitySystem = securitySystem;
ย ย ย ย ย ย ย ย this.currentCode = null;
ย ย ย ย ย ย ย ย this.initAdminEvents();
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async loadSettings() {
ย ย ย ย ย ย ย ย await this.securitySystem.loadConfig();
ย ย ย ย ย ย ย ย document.getElementById('max-devices').value = SECURITY_CONFIG.MAX_DEVICES;
ย ย ย ย ย ย ย ย document.getElementById('inactivity-timeout').value = SECURITY_CONFIG.INACTIVITY_TIMEOUT / (60 * 1000);
ย ย ย ย ย ย ย ย document.getElementById('redirect-url').value = SECURITY_CONFIG.REDIRECT_URL;
ย ย ย ย ย ย ย ย document.getElementById('admin-username-settings').value = SECURITY_CONFIG.ADMIN_USER;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย initAdminEvents() {
ย ย ย ย ย ย ย ย document.getElementById('admin-access').addEventListener('click', (e) => {
ย ย ย ย ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย ย ย ย ย document.getElementById('client-container').style.display = 'none';
ย ย ย ย ย ย ย ย ย ย document.getElementById('admin-login').style.display = 'block';
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย document.getElementById('admin-login-form').addEventListener('submit', (e) => {
ย ย ย ย ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย ย ย ย ย this.handleAdminLogin();
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย document.getElementById('logout-btn').addEventListener('click', () => this.handleAdminLogout());
ย ย ย ย ย ย ย ย document.querySelectorAll('.nav-btn').forEach(btn => btn.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab)));
ย ย ย ย ย ย ย ย document.getElementById('generate-code-btn').addEventListener('click', () => this.generateNewCode());
ย ย ย ย ย ย ย ย document.getElementById('code-selector').addEventListener('change', (e) => this.loadDevices(e.target.value));
ย ย ย ย ย ย ย ย document.getElementById('search-btn').addEventListener('click', () => this.applyFilters());
ย ย ย ย ย ย ย ย document.getElementById('clear-search').addEventListener('click', () => {
ย ย ย ย ย ย ย ย ย ย document.getElementById('code-search').value = '';
ย ย ย ย ย ย ย ย ย ย this.applyFilters();
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย document.getElementById('filter-status').addEventListener('change', () => this.applyFilters());
ย ย ย ย ย ย ย ย document.getElementById('filter-devices').addEventListener('change', () => this.applyFilters());
ย ย ย ย ย ย ย ย document.getElementById('filter-sort').addEventListener('change', () => this.applyFilters());
ย ย ย ย ย ย ย ย document.getElementById('save-settings').addEventListener('click', () => this.saveSettings());
ย ย ย ย ย ย ย ย document.getElementById('save-admin').addEventListener('click', () => this.saveAdminCredentials());
ย ย ย ย ย ย ย ย document.getElementById('export-data').addEventListener('click', () => this.exportData());
ย ย ย ย ย ย ย ย document.getElementById('import-data').addEventListener('click', () => this.importData());
ย ย ย ย ย ย ย ย document.getElementById('reset-data').addEventListener('click', () => this.resetData());
ย ย ย ย ย ย ย ย document.getElementById('save-code-btn').addEventListener('click', () => this.saveCode());
ย ย ย ย ย ย ย ย document.querySelectorAll('.close-modal, .modal').forEach(el => el.addEventListener('click', (e) => {
ย ย ย ย ย ย ย ย ย ย if (e.target === el) {
ย ย ย ย ย ย ย ย ย ย ย ย document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }));
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async handleAdminLogin() {
ย ย ย ย ย ย ย ย await this.securitySystem.loadConfig();
ย ย ย ย ย ย ย ย const username = document.getElementById('admin-user-login').value;
ย ย ย ย ย ย ย ย const password = document.getElementById('admin-password-login').value;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (username === SECURITY_CONFIG.ADMIN_USER && password === SECURITY_CONFIG.ADMIN_PASSWORD) {
ย ย ย ย ย ย ย ย ย ย document.getElementById('admin-login').style.display = 'none';
ย ย ย ย ย ย ย ย ย ย document.getElementById('admin-panel').style.display = 'block';
ย ย ย ย ย ย ย ย ย ย await this.loadAdminData();
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย document.getElementById('admin-message').textContent = 'Credenciales incorrectas';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย handleAdminLogout() {
ย ย ย ย ย ย ย ย document.getElementById('admin-panel').style.display = 'none';
ย ย ย ย ย ย ย ย document.getElementById('client-container').style.display = 'flex';
ย ย ย ย ย ย ย ย document.getElementById('admin-user-login').value = '';
ย ย ย ย ย ย ย ย document.getElementById('admin-password-login').value = '';
ย ย ย ย ย ย ย ย document.getElementById('admin-message').textContent = '';
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async switchTab(tabName) {
ย ย ย ย ย ย ย ย document.querySelectorAll('.tab-content, .nav-btn').forEach(el => el.classList.remove('active'));
ย ย ย ย ย ย ย ย document.getElementById(tabName).classList.add('active');
ย ย ย ย ย ย ย ย document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (tabName === 'codes') await this.loadCodes();
ย ย ย ย ย ย ย ย else if (tabName === 'devices') { await this.loadCodeSelector(); await this.loadDevices(); }
ย ย ย ย ย ย ย ย else if (tabName === 'dashboard') await this.loadDashboard();
ย ย ย ย ย ย ย ย else if (tabName === 'settings') await this.loadSettings();
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async loadAdminData() {
ย ย ย ย ย ย ย ย await this.loadDashboard();
ย ย ย ย ย ย ย ย await this.loadCodeSelector();
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async loadDashboard() {
ย ย ย ย ย ย ย ย const codes = await this.securitySystem.getAllCodes();
ย ย ย ย ย ย ย ย const activeCodes = codes.filter(c => c.active).length;
ย ย ย ย ย ย ย ย const totalDevices = codes.reduce((sum, code) => sum + code.devices, 0);
ย ย ย ย ย ย ย ย const usagePercentage = codes.length > 0 ? Math.round((totalDevices / (codes.length * SECURITY_CONFIG.MAX_DEVICES)) * 100) : 0;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย document.getElementById('stat-active').textContent = activeCodes;
ย ย ย ย ย ย ย ย document.getElementById('stat-inactive').textContent = codes.length - activeCodes;
ย ย ย ย ย ย ย ย document.getElementById('stat-devices').textContent = totalDevices;
ย ย ย ย ย ย ย ย document.getElementById('stat-usage').textContent = `${usagePercentage}%`;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const recentCodes = codes.sort((a, b) => b.created - a.created).slice(0, 5);
ย ย ย ย ย ย ย ย this.displayCodes(recentCodes, 'recent-codes');
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async loadCodes() {
ย ย ย ย ย ย ย ย await this.applyFilters();
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async applyFilters() {
ย ย ย ย ย ย ย ย let codes = await this.securitySystem.getAllCodes();
ย ย ย ย ย ย ย ย const status = document.getElementById('filter-status').value;
ย ย ย ย ย ย ย ย const devices = document.getElementById('filter-devices').value;
ย ย ย ย ย ย ย ย const sort = document.getElementById('filter-sort').value;
ย ย ย ย ย ย ย ย const search = document.getElementById('code-search').value.toLowerCase();

ย ย ย ย ย ย ย ย if (status) codes = codes.filter(c => c.active === (status === 'active'));
ย ย ย ย ย ย ย ย if (devices === 'full') codes = codes.filter(c => c.devices >= SECURITY_CONFIG.MAX_DEVICES);
ย ย ย ย ย ย ย ย if (devices === 'available') codes = codes.filter(c => c.devices < SECURITY_CONFIG.MAX_DEVICES);
ย ย ย ย ย ย ย ย if (search) codes = codes.filter(c => c.code.toLowerCase().includes(search) || (c.name && c.name.toLowerCase().includes(search)) || (c.phone && c.phone.includes(search)) || (c.email && c.email.toLowerCase().includes(search)));
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย codes.sort((a, b) => {
ย ย ย ย ย ย ย ย ย ย if (sort === 'recent') return b.created - a.created;
ย ย ย ย ย ย ย ย ย ย if (sort === 'oldest') return a.created - b.created;
ย ย ย ย ย ย ย ย ย ย if (sort === 'name') return (a.name || '').localeCompare(b.name || '');
ย ย ย ย ย ย ย ย ย ย if (sort === 'code') return a.code.localeCompare(b.code);
ย ย ย ย ย ย ย ย ย ย return 0;
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย this.displayCodes(codes, 'all-codes');
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย displayCodes(codes, containerId) {
ย ย ย ย ย ย ย ย const container = document.getElementById(containerId);
ย ย ย ย ย ย ย ย container.innerHTML = codes.length > 0 ? '' : '<p>No se encontraron cรณdigos</p>';
ย ย ย ย ย ย ย ย codes.forEach(codeData => container.appendChild(this.createCodeElement(codeData)));
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย createCodeElement(codeData) {
ย ย ย ย ย ย ย ย const el = document.createElement('div');
ย ย ย ย ย ย ย ย el.className = `code-item ${codeData.active ? '' : 'inactive'}`;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const created = codeData.created.toLocaleDateString();
ย ย ย ย ย ย ย ย const lastAccess = codeData.lastAccess ? codeData.lastAccess.toLocaleDateString() : 'Nunca';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย el.innerHTML = `
ย ย ย ย ย ย ย ย ย ย <div class="code-info">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="code-header">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="code-value">${codeData.code}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="status-badge ${codeData.active ? 'status-active' : 'status-inactive'}">${codeData.active ? 'Activo' : 'Inactivo'}</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ${codeData.name ? `<div class="code-name">${codeData.name}</div>` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ${codeData.phone ? `<div class="code-contact">๐ ${codeData.phone}</div>` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย <div class="code-stats">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span>${codeData.devices}/${SECURITY_CONFIG.MAX_DEVICES} disp.</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span>โข Creado: ${created}</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${codeData.lastAccess ? `<span>โข Acceso: ${lastAccess}</span>` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="code-actions">
ย ย ย ย ย ย ย ย ย ย ย ย <button class="action-btn btn-info"><i class="fas fa-info"></i></button>
ย ย ย ย ย ย ย ย ย ย ย ย <button class="action-btn btn-edit"><i class="fas fa-edit"></i></button>
ย ย ย ย ย ย ย ย ย ย ย ย <button class="action-btn ${codeData.active ? 'btn-deactivate' : 'btn-activate'}"><i class="fas ${codeData.active ? 'fa-ban' : 'fa-check'}"></i></button>
ย ย ย ย ย ย ย ย ย ย </div>`;
ย ย ย ย ย ย ย ย el.querySelector('.btn-info').onclick = () => this.showCodeDetails(codeData.code);
ย ย ย ย ย ย ย ย el.querySelector('.btn-edit').onclick = () => this.showCodeEditModal(codeData.code);
ย ย ย ย ย ย ย ย el.querySelector(codeData.active ? '.btn-deactivate' : '.btn-activate').onclick = () => this.toggleCodeStatus(codeData.code, !codeData.active);
ย ย ย ย ย ย ย ย return el;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async loadCodeSelector() {
ย ย ย ย ย ย ย ย const codes = (await this.securitySystem.getAllCodes()).filter(c => c.active && c.devices > 0);
ย ย ย ย ย ย ย ย const selector = document.getElementById('code-selector');
ย ย ย ย ย ย ย ย selector.innerHTML = '<option value="">Todos los dispositivos</option>';
ย ย ย ย ย ย ย ย codes.forEach(c => selector.innerHTML += `<option value="${c.code}">${c.code} - ${c.name || 'Sin nombre'} (${c.devices})</option>`);
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async loadDevices(codeFilter = '') {
ย ย ย ย ย ย ย ย const devices = await this.securitySystem.getDevicesByCode(codeFilter);
ย ย ย ย ย ย ย ย const container = document.getElementById('devices-list');
ย ย ย ย ย ย ย ย container.innerHTML = devices.length > 0 ? '' : '<p>No se encontraron dispositivos</p>';
ย ย ย ย ย ย ย ย devices.forEach(dev => {
ย ย ย ย ย ย ย ย ย ย const el = document.createElement('div');
ย ย ย ย ย ย ย ย ย ย el.className = 'device-item';
ย ย ย ย ย ย ย ย ย ย el.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย <div class="device-info">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="device-id">Cรณdigo: ${dev.code} ${dev.clientName ? `- ${dev.clientName}`: ''}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="device-id">ID: ${dev.id}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="device-meta">Registrado: ${new Date(dev.timestamp).toLocaleString()}</div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="code-actions"><button class="action-btn btn-deactivate"><i class="fas fa-trash"></i></button></div>`;
ย ย ย ย ย ย ย ย ย ย el.querySelector('.btn-deactivate').onclick = () => this.removeDevice(dev.code, dev.id);
ย ย ย ย ย ย ย ย ย ย container.appendChild(el);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async showCodeDetails(code) {
ย ย ย ย ย ย ย ย const codeData = (await this.securitySystem.getAllCodes()).find(c => c.code === code);
ย ย ย ย ย ย ย ย if (!codeData) return;
ย ย ย ย ย ย ย ย const devices = await this.securitySystem.getRegisteredDevices(code);
ย ย ย ย ย ย ย ย let devicesHTML = devices.length > 0 ? devices.map(d => `<div class="detail-row"><div class="detail-label">Dispositivo:</div><div class="detail-value">${d.id}</div></div>`).join('') : '<p>No hay dispositivos</p>';
ย ย ย ย ย ย ย ย document.getElementById('code-detail-content').innerHTML = `
ย ย ย ย ย ย ย ย ย ย <div class="detail-section">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="detail-row"><div class="detail-label">Cรณdigo:</div><div class="detail-value">${codeData.code}</div></div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="detail-row"><div class="detail-label">Cliente:</div><div class="detail-value">${codeData.name || 'N/A'}</div></div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="detail-section"><h4>Dispositivos Registrados</h4>${devicesHTML}</div>`;
ย ย ย ย ย ย ย ย document.getElementById('code-detail-modal').style.display = 'flex';
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async showCodeEditModal(code = null) {
ย ย ย ย ย ย ย ย this.currentCode = code;
ย ย ย ย ย ย ย ย document.getElementById('code-edit-title').textContent = code ? 'Editar Cรณdigo' : 'Nuevo Cรณdigo';
ย ย ย ย ย ย ย ย document.getElementById('edit-code').disabled = !!code;
ย ย ย ย ย ย ย ย if (code) {
ย ย ย ย ย ย ย ย ย ย const codeData = (await this.securitySystem.getAllCodes()).find(c => c.code === code);
ย ย ย ย ย ย ย ย ย ย document.getElementById('edit-code').value = codeData.code;
ย ย ย ย ย ย ย ย ย ย document.getElementById('edit-name').value = codeData.name || '';
ย ย ย ย ย ย ย ย ย ย document.getElementById('edit-phone').value = codeData.phone || '';
ย ย ย ย ย ย ย ย ย ย document.getElementById('edit-email').value = codeData.email || '';
ย ย ย ย ย ย ย ย ย ย document.getElementById('edit-notes').value = codeData.notes || '';
ย ย ย ย ย ย ย ย ย ย document.getElementById('edit-status').value = codeData.active ? 'active' : 'inactive';
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ['edit-code', 'edit-name', 'edit-phone', 'edit-email', 'edit-notes'].forEach(id => document.getElementById(id).value = '');
ย ย ย ย ย ย ย ย ย ย document.getElementById('edit-status').value = 'active';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย document.getElementById('code-edit-modal').style.display = 'flex';
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async saveCode() {
ย ย ย ย ย ย ย ย const code = document.getElementById('edit-code').value.toUpperCase();
ย ย ย ย ย ย ย ย if (!/^[A-Z0-9]{4}$/.test(code)) return alert('Cรณdigo invรกlido');
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const info = {
ย ย ย ย ย ย ย ย ย ย name: document.getElementById('edit-name').value,
ย ย ย ย ย ย ย ย ย ย phone: document.getElementById('edit-phone').value,
ย ย ย ย ย ย ย ย ย ย email: document.getElementById('edit-email').value,
ย ย ย ย ย ย ย ย ย ย notes: document.getElementById('edit-notes').value
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย const status = document.getElementById('edit-status').value === 'active';

ย ย ย ย ย ย ย ย await this.securitySystem.saveClientInfo(code, info);
ย ย ย ย ย ย ย ย await this.securitySystem.setCodeStatus(code, status);
ย ย ย ย ย ย ย ย if (!this.currentCode) {
ย ย ย ย ย ย ย ย ย ย await database.ref(`codes/${code}/created`).set(new Date().toISOString());
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย alert('Cรณdigo guardado');
ย ย ย ย ย ย ย ย document.getElementById('code-edit-modal').style.display = 'none';
ย ย ย ย ย ย ย ย await this.loadAdminData();
ย ย ย ย ย ย ย ย await this.loadCodes();
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async toggleCodeStatus(code, activate) {
ย ย ย ย ย ย ย ย await this.securitySystem.setCodeStatus(code, activate);
ย ย ย ย ย ย ย ย alert(`Cรณdigo ${activate ? 'activado' : 'desactivado'}`);
ย ย ย ย ย ย ย ย await this.loadAdminData();
ย ย ย ย ย ย ย ย await this.loadCodes();
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async removeDevice(code, deviceId) {
ย ย ย ย ย ย ย ย if (confirm('ยฟEliminar este dispositivo?')) {
ย ย ย ย ย ย ย ย ย ย await this.securitySystem.removeDevice(code, deviceId);
ย ย ย ย ย ย ย ย ย ย alert('Dispositivo eliminado');
ย ย ย ย ย ย ย ย ย ย await this.loadAdminData();
ย ย ย ย ย ย ย ย ย ย await this.loadDevices(document.getElementById('code-selector').value);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async generateNewCode() {
ย ย ย ย ย ย ย ย const newCode = await this.securitySystem.generateNewCode();
ย ย ย ย ย ย ย ย await this.showCodeEditModal(newCode);
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async saveSettings() {
ย ย ย ย ย ย ย ย const settings = {
ย ย ย ย ย ย ย ย ย ย maxDevices: parseInt(document.getElementById('max-devices').value),
ย ย ย ย ย ย ย ย ย ย inactivityTimeout: parseInt(document.getElementById('inactivity-timeout').value),
ย ย ย ย ย ย ย ย ย ย redirectUrl: document.getElementById('redirect-url').value
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย await this.securitySystem.updateSettings(settings);
ย ย ย ย ย ย ย ย alert('Configuraciรณn guardada');
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async saveAdminCredentials() {
ย ย ย ย ย ย ย ย const username = document.getElementById('admin-username-settings').value;
ย ย ย ย ย ย ย ย const password = document.getElementById('admin-password-settings').value;
ย ย ย ย ย ย ย ย const confirm = document.getElementById('admin-password-confirm').value;
ย ย ย ย ย ย ย ย if (!username) return alert('El usuario no puede estar vacรญo');
ย ย ย ย ย ย ย ย if (password !== confirm) return alert('Las contraseรฑas no coinciden');
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const creds = { adminUser: username };
ย ย ย ย ย ย ย ย if (password) creds.adminPassword = password;
ย ย ย ย ย ย ย ย await this.securitySystem.updateSettings(creds);
ย ย ย ย ย ย ย ย alert('Credenciales guardadas');
ย ย ย ย ย ย ย ย document.getElementById('admin-password-settings').value = '';
ย ย ย ย ย ย ย ย document.getElementById('admin-password-confirm').value = '';
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async exportData() {
ย ย ย ย ย ย ย ย const data = await this.securitySystem.exportData();
ย ย ย ย ย ย ย ย const blob = new Blob([data], { type: 'application/json' });
ย ย ย ย ย ย ย ย const a = document.createElement('a');
ย ย ย ย ย ย ย ย a.href = URL.createObjectURL(blob);
ย ย ย ย ย ย ย ย a.download = `backup-sistema-acceso.json`;
ย ย ย ย ย ย ย ย a.click();
ย ย ย ย ย ย ย ย URL.revokeObjectURL(a.href);
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย importData() {
ย ย ย ย ย ย ย ย const input = document.createElement('input');
ย ย ย ย ย ย ย ย input.type = 'file';
ย ย ย ย ย ย ย ย input.accept = '.json';
ย ย ย ย ย ย ย ย input.onchange = e => {
ย ย ย ย ย ย ย ย ย ย const file = e.target.files[0];
ย ย ย ย ย ย ย ย ย ย if (!file) return;
ย ย ย ย ย ย ย ย ย ย const reader = new FileReader();
ย ย ย ย ย ย ย ย ย ย reader.onload = async (event) => {
ย ย ย ย ย ย ย ย ย ย ย ย if (await this.securitySystem.importData(event.target.result)) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย alert('Datos importados correctamente');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย await this.loadAdminData();
ย ย ย ย ย ย ย ย ย ย ย ย } else alert('Error al importar');
ย ย ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย ย ย reader.readAsText(file);
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย input.click();
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย async resetData() {
ย ย ย ย ย ย ย ย if (await this.securitySystem.resetData()) {
ย ย ย ย ย ย ย ย ย ย alert('Datos restablecidos');
ย ย ย ย ย ย ย ย ย ย await this.loadAdminData();
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ยย
ย ย ย ย // Funciรณn para poblar la base de datos si estรก vacรญa
ย ย ย ย async function seedInitialData() {
ย ย ย ย ย ย const snapshot = await database.ref('codes').once('value');
ย ย ย ย ย ย if (!snapshot.exists()) {
ย ย ย ย ย ย ย ย console.log("Base de datos vacรญa, poblando con datos iniciales...");
ย ย ย ย ย ย ย ย const initialCodes = "Q9R1,P9M4,Y0Q5,X9P4,W8O3,V7N2,U6M1,T5L0,V4W8,S4K9,R3J8,Q2I7,D2E6,P1H6,J5O9,U4W8,J4B9,O0G5,N9F4,M8E3,L7D2,N0O4,K6C1,J5B0,I4A9,U2Z6,J0K4,H3Z8,I7A3,T7Y1,F1X6,Q6S0,E0W5,D9V4,C8U3,A6S1,G2Y7,Z5R0,X8Y2,Y4Q9,Q9R1,W207,X3P8,G9K4,S9U3,V1N6,U0M5,T9L4,J3M7,S8K3,R7J2,Q6I1,P5H9,O4G9,N3F8,M2E7,L1D6,K0C5,J9B4,I8A3,H7Z2,G6Y1,F5X0,E4W9,D3V8,C2U7,B1T6,A0S5,Z9R4,Y8Q3,X7P2,K5M9,J3L7".split(',');
ย ย ย ย ย ย ย ย const updates = {};
ย ย ย ย ย ย ย ย for (const code of [...new Set(initialCodes)]) { // Eliminar duplicados
ย ย ย ย ย ย ย ย ย ย updates[code] = {
ย ย ย ย ย ย ย ย ย ย ย ย active: true,
ย ย ย ย ย ย ย ย ย ย ย ย created: new Date().toISOString()
ย ย ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย await database.ref('codes').set(updates);
ย ย ย ย ย ย ย ย console.log("Datos iniciales guardados en Firebase.");
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // ๐ Inicializaciรณn del Sistema
ย ย ย ย document.addEventListener('DOMContentLoaded', async () => {
ย ย ย ย ย ย await seedInitialData();
ย ย ย ย ย ยย
ย ย ย ย ย ย const securitySystem = new CodeSecuritySystem();
ย ย ย ย ย ย const adminSystem = new AdminSystem(securitySystem);
ย ย ย ย ย ยย
ย ย ย ย ย ย const accessForm = document.getElementById('access-form');
ย ย ย ย ย ย const codeInput = document.getElementById('code');
ย ย ย ย ย ย const messageEl = document.getElementById('message');
ย ย ย ย ย ย const deviceInfoEl = document.getElementById('device-info');

ย ย ย ย ย ย codeInput.addEventListener('input', async function() {
ย ย ย ย ย ย ย ย this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
ย ย ย ย ย ย ย ย deviceInfoEl.textContent = this.value.length === 4 ? 'Consultando...' : '';
ย ย ย ย ย ย ย ย if (this.value.length === 4) {
ย ย ย ย ย ย ย ย ย ย const info = await securitySystem.getDeviceRegistrationInfo(this.value);
ย ย ย ย ย ย ย ย ย ย updateDeviceInfoDisplay(info);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });

ย ย ย ย ย ย function updateDeviceInfoDisplay(info) {
ย ย ย ย ย ย ย ย if (info.isRegistered) {
ย ย ย ย ย ย ย ย ย ย deviceInfoEl.innerHTML = `โ Dispositivo registrado (${info.registeredDevices}/${info.maxDevices})`;
ย ย ย ย ย ย ย ย ย ย deviceInfoEl.className = 'success';
ย ย ย ย ย ย ย ย } else if (info.availableSlots > 0) {
ย ย ย ย ย ย ย ย ย ย deviceInfoEl.innerHTML = `โ๏ธ Quedan ${info.availableSlots} espacios de ${info.maxDevices}`;
ย ย ย ย ย ย ย ย ย ย deviceInfoEl.className = 'warning';
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย deviceInfoEl.innerHTML = `โ Lรญmite de dispositivos alcanzado (${info.maxDevices})`;
ย ย ย ย ย ย ย ย ย ย deviceInfoEl.className = 'error';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย accessForm.addEventListener('submit', async function(e) {
ย ย ย ย ย ย ย ย e.preventDefault();
ย ย ย ย ย ย ย ย const code = codeInput.value.trim();
ย ย ย ย ย ย ย ย if (!/^[A-Z0-9]{4}$/.test(code)) return showMessage("โ El cรณdigo debe ser de 4 caracteres", "error");

ย ย ย ย ย ย ย ย showMessage("๐ Verificando cรณdigo...", "info");
ย ย ย ย ย ย ย ย const result = await securitySystem.validateAccessCode(code);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (result.valid) {
ย ย ย ย ย ย ย ย ย ย showMessage("โ Acceso concedido...", "success");
ย ย ย ย ย ย ย ย ย ย setTimeout(() => { window.location.href = SECURITY_CONFIG.REDIRECT_URL; }, 1500);
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย showMessage(`โ ${result.error}`, "error");
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });

ย ย ย ย ย ย function showMessage(text, type) {
ย ย ย ย ย ย ย ย messageEl.textContent = text;
ย ย ย ย ย ย ย ย messageEl.className = type;
ย ย ย ย ย ย }
ย ย ย ย });
ย ย </script>
</body>
</html>
